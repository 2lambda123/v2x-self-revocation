# Tamarin models

Two folders:
- `sol1` is the model for the protocol that uses trusted time (Sect. 4.1)
- `sol2` is the model for the protocol that uses epochs (Sect. 4.2)

The models are defined in the files called `theory.spthy`. 

We successfully verified all the lemmas in the models using Tamarin version
`1.7.1`. Outputs from previous execution are found in `output.txt` and
`output.spthy`.

The oracles `oracle.py` help Tamarin to create efficient proofs and allow it to
terminate. Without it, Tamarin would either use too much memory or get stuck in
some proofs.

More details can be found in the paper (Sect. 4.3 and Appendix B).

## Run with Docker

We built Docker images from the Tamarin
[official repository](https://github.com/tamarin-prover/tamarin-prover). We used the
official Dockerfile found under `etc/docker`. We only slightly modified the
Dockerfile to install Python, in order to run the oracles.

The Docker images are publicly available at `selfrevocation/tamarin`. Different
tags use different Tamarin versions:
- `latest` (or `v1.7.1`) was built from commit
  `ba7f2b8b259c3808441b093b4fff039430753332`. This version was originally used
  to prove the models before the first submission.
- `v1.6.1` was built from tag `1.6.1`, which corresponds to the latest official
  Tamarin release. This version was recently used to verify the models
  (successfully).

We provide a Makefile with targets to prove the two models using Docker.

### Run

The target `prove` is used to run Tamarin in the background. The model to prove
can be chosen by overriding the `MODEL` variable, indicating either `sol1`
(default) or `sol2`. The first model is more computationally expensive: it may
take around one hour and use ~5-10 GB of memory. The second model is quite fast
to verify, taking only a couple of minutes.

An example on how to verify the second model is provided below:

```bash
### Run container ###
# A container will start in the background.
make prove MODEL=sol2

### Check state of container ###
# Check if container is still running
watch docker ps -a --filter name=tamarin

### Check results ###
# When a container exits, it means that Tamarin has completed. To check the results:
docker logs -n 50 tamarin

### Delete container ###
docker rm tamarin
```

After the container terminates, the complete proof generated by Tamarin can be
found under `out/output.spthy`.

### Interactive mode

Tamarin can run in interactive mode thanks to an intuitive web application. The
target `interactive` is used for this purpose.

Example:

```bash
### Run container ###
# A container will start in the background.
make interactive MODEL=sol2

# The Tamarin interactive webapp will be available at localhost:3001

# Stop container and clean up
make clean
```